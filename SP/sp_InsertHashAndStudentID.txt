USE [Student-Attendance-System]
GO
/****** Object:  StoredProcedure [dbo].[sp_InsertHashAndStudentID]    Script Date: 2/12/2026 10:18:36 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER   PROC [dbo].[sp_InsertHashAndStudentID]
    @studentID INT,
    @hash VARCHAR(300)
AS
BEGIN
    SET NOCOUNT ON;
 
    DECLARE @hashid INT;
 
    IF EXISTS (
        SELECT 1
        FROM dbo.hashtable
        WHERE studentID = @studentID
    )
    BEGIN
        THROW 50001, 'The student is already registered', 1;
    END
    ELSE
    BEGIN
        INSERT INTO dbo.hashtable (studentID, hash)
        VALUES (@studentID, @hash);
 
        SET @hashid = CAST(SCOPE_IDENTITY() AS INT);
 
        SELECT 
            @hashid AS id,
            @hash AS hash,
            @studentID AS studentID;
    END
END;